{
    "openapi": "3.0.0",
    "info": {
        "title": "Compte API",
        "version": "v1",
        "description": "Documentation minimale — ajoutez ici vos endpoints OpenAPI."
    },
    "servers": [
        { "url": "http://localhost:8000", "description": "Local development (use /api/v1 paths)" },
        { "url": "https://compte-api-hjvy.onrender.com/khouss.ngom", "description": "Hosted docs (Render) — production prefix /khouss.ngom (khouss.ngom)" },
        { "url": "/", "description": "Use same origin as Swagger UI (recommended for hosted docs)" }
    ],
    "paths": {
        "/api/v1/comptes/{id}/archive": {
            "post": {
                "summary": "Archiver un compte (marquer comme archived)",
                "tags": ["Comptes"],
                "parameters": [
                    { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "ID numérique du compte à archiver" }
                ],
                "responses": {
                    "200": {
                        "description": "Compte archivé avec succès",
                        "content": {
                            "application/json": {
                                "schema": { "$ref": "#/components/schemas/ArchiveResponse" }
                            }
                        }
                    },
                    "403": { "description": "Accès refusé" },
                    "404": { "description": "Compte introuvable" }
                }
            }
        },
            "/api/v1/comptes": {
            "get": {
                "summary": "Lister tous les comptes",
                "description": "Récupère une liste paginée de comptes avec possibilité de filtrage et tri",
                "tags": ["Comptes"],
                "parameters": [
                    { "name": "page", "in": "query", "schema": { "type": "integer", "default": 1 }, "description": "Numéro de page" },
                    { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 10 }, "description": "Nombre d'éléments par page" },
                    { "name": "type", "in": "query", "schema": { "type": "string", "enum": ["epargne", "cheque"] }, "description": "Filtrer par type de compte" },
                    { "name": "statut", "in": "query", "schema": { "type": "string", "enum": ["actif", "bloque", "ferme"] }, "description": "Filtrer par statut" },
                    { "name": "search", "in": "query", "schema": { "type": "string" }, "description": "Recherche par numéro de compte ou nom du titulaire" },
                    { "name": "sort", "in": "query", "schema": { "type": "string", "enum": ["date_creation", "solde", "titulaire_compte"], "default": "date_creation" }, "description": "Champ de tri (utilisez les clés exactes: date_creation, solde, titulaire_compte)" },
                    { "name": "order", "in": "query", "schema": { "type": "string", "enum": ["asc", "desc"], "default": "desc" }, "description": "Ordre de tri" }
                ],
                "responses": {
                "200": {
                    "description": "Liste des comptes récupérée avec succès",
                    "content": {
                    "application/json": {
                        "schema": { "$ref": "#/components/schemas/ComptesResponse" }
                    }
                    }
                }
                }
            }
            },
            "/api/v1/comptes-demo": {
            "get": {
                "summary": "Endpoint de démonstration public pour la doc",
                "responses": { "200": { "description": "OK" } }
            }
            },
            "/api/v1/accounts": {
            "post": {
                "summary": "Créer un compte bancaire avec client",
                "description": "Crée un utilisateur, un client et un compte bancaire avec validation stricte.",
                "tags": ["Accounts"],
                "requestBody": {
                "required": true,
                "content": {
                    "application/json": {
                    "schema": {
                        "type": "object",
                        "required": ["type", "soldeInitial", "devise", "solde", "client"],
                        "properties": {
                        "type": { "type": "string", "enum": ["cheque", "epargne"] },
                        "soldeInitial": { "type": "number", "minimum": 10000 },
                        "devise": { "type": "string", "enum": ["FCFA", "XOF"] },
                        "solde": { "type": "number", "minimum": 0 },
                        "client": {
                            "type": "object",
                            "required": ["titulaire", "nci", "email", "telephone", "adresse"],
                            "properties": {
                            "id": { "type": "integer", "nullable": true },
                            "titulaire": { "type": "string" },
                            "nci": { "type": "string", "pattern": "^[12][0-9]{12}$" },
                            "email": { "type": "string", "format": "email" },
                            "telephone": { "type": "string", "pattern": "^\\+221(77|78|70|76|75)[0-9]{7}$" },
                            "adresse": { "type": "string" }
                            }
                        }
                        }
                    },
                    "example": {
                        "type": "cheque",
                        "soldeInitial": 500000,
                        "devise": "FCFA",
                        "solde": 10000,
                        "client": {
                        "id": null,
                        "titulaire": "khouss Ngom",
                        "nci": "1234567890123",
                        "email": "cheikh@example.com",
                        "telephone": "+221771234567",
                        "adresse": "Dakar, Sénégal"
                        }
                    }
                    }
                }
                },
                "responses": {
                "201": {
                    "description": "Compte créé avec succès",
                    "content": {
                    "application/json": {
                        "schema": { "$ref": "#/components/schemas/AccountCreationSuccessResponse" }
                    }
                    }
                },
                "400": {
                    "description": "Données invalides",
                    "content": {
                    "application/json": {
                        "schema": { "$ref": "#/components/schemas/ValidationErrorResponse" }
                    }
                    }
                },
                "500": { "description": "Erreur serveur" }
                }
            }
            },
            "/api/v1/users/clients": {
            "get": {
                "summary": "Lister les utilisateurs qui sont clients",
                "tags": ["Users"],
                "responses": {
                "200": {
                    "description": "Liste des clients",
                    "content": { "application/json": { "schema": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "array", "items": { "$ref": "#/components/schemas/UserWithClient" } } } } } }
                }
                }
            }
            },
            "/api/v1/users/admins": {
            "get": {
                "summary": "Lister les utilisateurs qui sont admins",
                "tags": ["Users"],
                "responses": {
                "200": {
                    "description": "Liste des admins",
                    "content": { "application/json": { "schema": { "type": "object", "properties": { "success": { "type": "boolean" }, "data": { "type": "array", "items": { "$ref": "#/components/schemas/UserWithAdmin" } } } } } }
                }
                }
            }
            }
            ,
            "/api/v1/comptes/{numeroCompte}": {
                "get": {
                    "summary": "Récupérer un compte par son numéro (Admin ou Client)",
                    "tags": ["Comptes"],
                    "parameters": [
                        { "name": "numeroCompte", "in": "path", "required": true, "schema": { "type": "string" }, "description": "Numéro de compte (numero_compte)" }
                    ],
                    "responses": {
                        "200": {
                            "description": "Compte récupéré",
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "success": { "type": "boolean" },
                                            "data": { "$ref": "#/components/schemas/Compte" }
                                        }
                                    }
                                }
                            }
                        },
                        "403": { "description": "Accès refusé" },
                        "404": {
                            "description": "Compte introuvable",
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "success": { "type": "boolean", "example": false },
                                            "error": {
                                                "type": "object",
                                                "properties": {
                                                    "code": { "type": "string", "example": "COMPTE_NOT_FOUND" },
                                                    "message": { "type": "string", "example": "Le compte C00123456 est introuvable" }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            ,
            "/api/v1/comptes/{identifiant}": {
                "patch": {
                    "summary": "Mettre à jour un compte (par id ou numero)",
                    "tags": ["Comptes"],
                    "description": "Met à jour les informations d'un compte et du client associé. Tous les champs sont optionnels mais au moins un doit être fourni. Aucune authentification requise.",
                    "parameters": [
                        { "name": "identifiant", "in": "path", "required": true, "schema": { "type": "string" }, "description": "ID (UUID) ou numéro du compte (numero_compte)" }
                    ],
                    "requestBody": {
                        "required": true,
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "titulaire": { "type": "string", "description": "Nom du titulaire" },
                                        "informationsClient": {
                                            "type": "object",
                                            "properties": {
                                                "telephone": { "type": "string", "pattern": "^\\+221(77|78|70|76|75)[0-9]{7}$", "description": "Numéro Sénégalais (unique)" },
                                                "email": { "type": "string", "format": "email", "description": "Email du client (unique)" },
                                                "password": { "type": "string", "description": "Mot de passe en clair (sera hashé avant sauvegarde)" },
                                                "nci": { "type": "string", "pattern": "^[12][0-9]{12}$", "description": "NCI valide" }
                                            }
                                        }
                                    },
                                    "example": {
                                        "titulaire": "Amadou Diallo Junior",
                                        "informationsClient": {
                                            "telephone": "+221771234568",
                                            "email": "amadou.jr@example.com",
                                            "password": "nouveauMdp123",
                                            "nci": "1234567890123"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "responses": {
                        "201": {
                            "description": "Compte mis à jour avec succès",
                            "content": {
                                "application/json": {
                                    "schema": { "$ref": "#/components/schemas/AccountUpdateSuccessResponse" }
                                }
                            }
                        },
                        "400": { "description": "Données invalides ou aucune donnée fournie" },
                        "404": { "description": "Compte introuvable" },
                        "422": { "description": "Erreur de validation (par ex. email/telephone déjà utilisé)" }
                    }
                }
            }
                ,
                "/api/v1/comptes/{compte}/bloquer": {
                "post": {
                    "summary": "Bloquer un compte (enregistrer période et motif)",
                    "tags": ["Comptes"],
                    "parameters": [
                        { "name": "compte", "in": "path", "required": true, "schema": { "type": "integer" }, "description": "ID du compte à bloquer" }
                    ],
                    "requestBody": {
                        "required": true,
                        "content": {
                            "application/json": {
                                "schema": { "$ref": "#/components/schemas/BlocageRequest" },
                                "example": {
                                    "date_debut_blocage": "2025-10-25",
                                    "date_fin_blocage": "2025-10-28",
                                    "motif_blocage": "Suspicion de fraude"
                                }
                            }
                        }
                    },
                    "responses": {
                        "200": {
                            "description": "Données de blocage enregistrées",
                            "content": {
                                "application/json": {
                                    "schema": { "$ref": "#/components/schemas/BlocageResponse" }
                                }
                            }
                        },
                        "400": { "description": "Données invalides" },
                        "404": { "description": "Compte introuvable" }
                    }
                }
            },
            "/api/v1/comptes/numero/{numero}/bloquer": {
                "post": {
                    "summary": "Bloquer un compte par numéro (numero_compte)",
                    "tags": ["Comptes"],
                    "parameters": [
                        { "name": "numero", "in": "path", "required": true, "schema": { "type": "string" }, "description": "Numéro de compte (numero_compte)" }
                    ],
                    "requestBody": {
                        "required": true,
                        "content": {
                            "application/json": {
                                "schema": { "$ref": "#/components/schemas/BlocageRequest" },
                                "example": {
                                    "date_debut_blocage": "2025-10-25",
                                    "date_fin_blocage": "2025-10-28",
                                    "motif_blocage": "Suspicion de fraude"
                                }
                            }
                        }
                    },
                    "responses": {
                        "200": { "description": "Données de blocage enregistrées", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BlocageResponse" } } } },
                        "400": { "description": "Données invalides" },
                        "404": { "description": "Compte introuvable" }
                    }
                }
            }
        },
        "components": {
            "schemas": {
            "Compte": {
                "type": "object",
                "properties": {
                "id": { "type": "string", "format": "uuid" },
                "numeroCompte": { "type": "string" },
                "titulaire": { "type": "string" },
                "type": { "type": "string", "enum": ["epargne", "cheque"] },
                "solde": { "type": "number" },
                "devise": { "type": "string" },
                "dateCreation": { "type": "string", "format": "date-time" },
                "statut": { "type": "string", "enum": ["actif", "bloque", "ferme"] },
                "dateDebutBlocage": { "type": "string", "format": "date", "nullable": true },
                "dateFinBlocage": { "type": "string", "format": "date", "nullable": true },
                "motifBlocage": { "type": "string", "nullable": true },
                "archived": { "type": "boolean", "nullable": true },
                "metadonnees": { "type": "object", "properties": { "derniereModification": { "type": "string", "format": "date-time" }, "version": { "type": "integer" } } }
                }
            },
            "Pagination": {
                "type": "object",
                "properties": {
                "currentPage": { "type": "integer" },
                "totalPages": { "type": "integer" },
                "totalItems": { "type": "integer" },
                "itemsPerPage": { "type": "integer" },
                "hasNext": { "type": "boolean" },
                "hasPrevious": { "type": "boolean" }
                }
            },
            "Links": {
                "type": "object",
                "properties": {
                "self": { "type": "string" },
                "next": { "type": "string" },
                "first": { "type": "string" },
                "last": { "type": "string" }
                }
            },
            "ComptesResponse": {
                "type": "object",
                "properties": {
                "success": { "type": "boolean" },
                "data": { "type": "array", "items": { "$ref": "#/components/schemas/Compte" } },
                "pagination": { "$ref": "#/components/schemas/Pagination" },
                "links": { "$ref": "#/components/schemas/Links" }
                }
            },
            "AccountCreationSuccessResponse": {
                "type": "object",
                "properties": {
                "success": { "type": "boolean", "example": true },
                "message": { "type": "string", "example": "Compte créé avec succès" },
                "data": {
                    "type": "object",
                    "properties": {
                    "id": { "type": "string", "example": "660f9511-f30c-52e5-b827-557766551111" },
                    "numeroCompte": { "type": "string", "example": "C00123460" },
                    "titulaire": { "type": "string", "example": "Cheikh Sy" },
                    "type": { "type": "string", "example": "cheque" },
                    "solde": { "type": "number", "example": 500000 },
                    "devise": { "type": "string", "example": "FCFA" },
                    "dateCreation": { "type": "string", "format": "date-time", "example": "2025-10-19T10:30:00Z" },
                    "statut": { "type": "string", "example": "actif" },
                    "metadata": {
                        "type": "object",
                        "properties": {
                        "derniereModification": { "type": "string", "format": "date-time", "example": "2025-10-19T10:30:00Z" },
                        "version": { "type": "integer", "example": 1 }
                        }
                    }
                    }
                }
                }
            },
            "AccountUpdateSuccessResponse": {
                "type": "object",
                "properties": {
                "success": { "type": "boolean", "example": true },
                "message": { "type": "string", "example": "Compte mis à jour avec succès" },
                "data": { "$ref": "#/components/schemas/Compte" }
                }
            },
            "ValidationErrorResponse": {
                "type": "object",
                "properties": {
                "success": { "type": "boolean", "example": false },
                "error": {
                    "type": "object",
                    "properties": {
                    "code": { "type": "string", "example": "VALIDATION_ERROR" },
                    "message": { "type": "string", "example": "Les données fournies sont invalides" },
                    "details": {
                        "type": "object",
                        "additionalProperties": { "type": "string" },
                        "example": {
                        "soldeInitial": "Le solde initial doit être supérieur ou égal à 10000"
                        }
                    }
                    }
                }
                }
            },
            "UserWithClient": {
                "type": "object",
                "properties": {
                "id": { "type": "string" },
                "nom": { "type": "string" },
                "prenom": { "type": "string" },
                "email": { "type": "string" },
                "telephone": { "type": "string" },
                "client": { "type": "object" }
                }
            },
            "UserWithAdmin": {
                "type": "object",
                "properties": {
                "id": { "type": "string" },
                "nom": { "type": "string" },
                "prenom": { "type": "string" },
                "email": { "type": "string" },
                "telephone": { "type": "string" },
                "admin": { "type": "object" }
                }
            }
            ,
            "BlocageRequest": {
                "type": "object",
                "required": ["date_debut_blocage", "date_fin_blocage", "motif_blocage"],
                "properties": {
                    "date_debut_blocage": { "type": "string", "format": "date", "example": "2025-10-25" },
                    "date_fin_blocage": { "type": "string", "format": "date", "example": "2025-10-28" },
                    "motif_blocage": { "type": "string", "example": "Suspicion de fraude" }
                }
            },
            "BlocageResponse": {
                "type": "object",
                "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Données de blocage enregistrées" },
                    "data": { "$ref": "#/components/schemas/Compte" }
                }
            }
            ,
            "ArchiveResponse": {
                "type": "object",
                "properties": {
                    "success": { "type": "boolean", "example": true },
                    "message": { "type": "string", "example": "Compte archivé avec succès" },
                    "data": { "$ref": "#/components/schemas/Compte" }
                }
            }
            }
        }
}
